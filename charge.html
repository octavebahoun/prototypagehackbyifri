<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Academix — Guide d'Intégration Frontend</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Fira+Code:wght@400;500;600&display=swap"
    rel="stylesheet" />
  <style>
    * {
      font-family: "Inter", sans-serif;
    }

    html {
      scroll-behavior: smooth;
    }

    code,
    pre {
      font-family: "Fira Code", monospace;
    }

    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .nav-link {
      transition: all 0.3s ease;
    }

    .nav-link:hover {
      transform: translateX(8px);
      color: #667eea;
    }

    .nav-link.active {
      color: #667eea;
      font-weight: 600;
      border-left: 3px solid #667eea;
      padding-left: 13px;
    }

    .card-hover {
      transition: all 0.3s ease;
    }

    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 1.5rem;
      border-radius: 0.75rem;
      overflow-x: auto;
      font-size: 0.875rem;
      line-height: 1.7;
    }

    .code-block {
      position: relative;
    }

    .code-label {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: rgba(255, 255, 255, 0.1);
      color: #94a3b8;
      padding: 0.25rem 0.75rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .api-endpoint {
      background: #0f172a;
      border-left: 4px solid #3b82f6;
      padding: 1rem;
      border-radius: 0.5rem;
      margin: 1rem 0;
    }

    .api-method {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-weight: 600;
      font-size: 0.75rem;
      margin-right: 0.5rem;
    }

    .method-get {
      background: #10b981;
      color: white;
    }

    .method-post {
      background: #3b82f6;
      color: white;
    }

    .method-put {
      background: #f59e0b;
      color: white;
    }

    .method-delete {
      background: #ef4444;
      color: white;
    }

    .method-patch {
      background: #8b5cf6;
      color: white;
    }

    .sidebar {
      position: sticky;
      top: 20px;
      height: calc(100vh - 40px);
      overflow-y: auto;
    }

    .sidebar::-webkit-scrollbar {
      width: 6px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: #f1f5f9;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }

    .sidebar::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

    .step-number {
      width: 2rem;
      height: 2rem;
      background: #667eea;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }

    .highlight-box {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-left: 4px solid #f59e0b;
      padding: 1rem;
      border-radius: 0.5rem;
      margin: 1rem 0;
    }

    .info-box {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border-left: 4px solid #3b82f6;
      padding: 1rem;
      border-radius: 0.5rem;
      margin: 1rem 0;
    }
  </style>
</head>

<body class="bg-gray-50">
  <!-- Top Navigation -->
  <nav class="gradient-bg text-white shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <span class="material-icons text-3xl">integration_instructions</span>
          <div>
            <h1 class="text-xl font-bold">Guide d'Intégration Frontend</h1>
            <p class="text-sm opacity-90">Consommation des APIs — Stack Vanilla JS</p>
          </div>
        </div>
        <div class="flex items-center space-x-3">
          <a href="index.html"
            class="flex items-center space-x-2 bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition">
            <span class="material-icons">home</span>
            <span>Prototypes</span>
          </a>
          <a href="docu.html"
            class="flex items-center space-x-2 bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition">
            <span class="material-icons">description</span>
            <span>Documentation</span>
          </a>
          <a href="charge.html"
            class="flex items-center space-x-2 bg-white text-purple-600 px-4 py-2 rounded-lg transition font-semibold">
            <span class="material-icons">integration_instructions</span>
            <span>Intégration API</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-6 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
      <!-- Sidebar Navigation -->
      <div class="lg:col-span-1">
        <div class="sidebar bg-white rounded-xl shadow-md p-6">
          <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4">
            Navigation
          </h3>
          <nav class="space-y-2">
            <a href="#intro" class="nav-link block py-2 text-gray-700 text-sm">
              <span class="material-icons text-sm align-middle mr-2">info</span>
              Introduction
            </a>
            <a href="#auth-service" class="nav-link block py-2 text-gray-700 text-sm">
              <span class="material-icons text-sm align-middle mr-2">code</span>
              Service API Global
            </a>
            <a href="#login" class="nav-link block py-2 text-gray-700 text-sm">
              <span class="material-icons text-sm align-middle mr-2">login</span>
              Login Page
            </a>
            <a href="#dashboard" class="nav-link block py-2 text-gray-700 text-sm">
              <span class="material-icons text-sm align-middle mr-2">dashboard</span>
              Dashboard
            </a>
            <a href="#profile" class="nav-link block py-2 text-gray-700 text-sm">
              <span class="material-icons text-sm align-middle mr-2">account_circle</span>
              Profil
            </a>
            <a href="#calendar" class="nav-link block py-2 text-gray-700 text-sm">
              <span class="material-icons text-sm align-middle mr-2">calendar_month</span>
              Calendrier
            </a>
            <a href="#grades" class="nav-link block py-2 text-gray-700 text-sm">
              <span class="material-icons text-sm align-middle mr-2">grade</span>
              Notes
            </a>
            <a href="#quiz" class="nav-link block py-2 text-gray-700 text-sm">
              <span class="material-icons text-sm align-middle mr-2">quiz</span>
              Quiz Interactif
            </a>
            <a href="#ai-generation" class="nav-link block py-2 text-gray-700 text-sm">
              <span class="material-icons text-sm align-middle mr-2">auto_awesome</span>
              Génération IA
            </a>
            <a href="#ai-results" class="nav-link block py-2 text-gray-700 text-sm">
              <span class="material-icons text-sm align-middle mr-2">description</span>
              Résultats IA
            </a>
            <a href="#best-practices" class="nav-link block py-2 text-gray-700 text-sm">
              <span class="material-icons text-sm align-middle mr-2">tips_and_updates</span>
              Bonnes Pratiques
            </a>
          </nav>
        </div>
      </div>

      <!-- Content -->
      <div class="lg:col-span-3 space-y-8">
        <!-- Introduction -->
        <section id="intro" class="bg-white rounded-xl shadow-md p-8">
          <div class="flex items-center space-x-3 mb-6">
            <span class="material-icons text-4xl gradient-text">info</span>
            <h2 class="text-3xl font-bold text-gray-800">Introduction</h2>
          </div>
          <p class="text-gray-600 mb-4">
            Ce guide explique comment intégrer les APIs dans chaque page du prototype en
            utilisant <strong>HTML, CSS et JavaScript vanilla</strong> (sans framework).
          </p>
          <div class="highlight-box">
            <p class="text-amber-900 font-semibold mb-2">
              <span class="material-icons text-sm align-middle mr-1">lightbulb</span>
              Stack Frontend
            </p>
            <ul class="text-amber-800 text-sm space-y-1">
              <li>✓ HTML5 pour la structure</li>
              <li>✓ CSS3 + Tailwind CSS pour le style</li>
              <li>✓ JavaScript Vanilla pour la logique</li>
              <li>✓ Fetch API pour les appels HTTP</li>
              <li>✓ LocalStorage pour le token d'authentification</li>
              <li>✓ Socket.io-client pour le temps réel (quiz, sessions)</li>
            </ul>
          </div>
          <div class="info-box">
            <p class="text-blue-900 font-semibold mb-2">
              <span class="material-icons text-sm align-middle mr-1">api</span>
              URLs des APIs
            </p>
            <ul class="text-blue-800 text-sm space-y-1">
              <li>
                <strong>Backend Laravel :</strong>
                <code class="bg-white px-2 py-1 rounded">https://api.plateforme-academique.com/api/v1</code>
              </li>
              <li>
                <strong>Service IA Python :</strong>
                <code class="bg-white px-2 py-1 rounded">https://ia.plateforme-academique.com/api/v1</code>
              </li>
              <li>
                <strong>WebSocket Temps Réel :</strong>
                <code class="bg-white px-2 py-1 rounded">wss://realtime.plateforme-academique.com</code>
              </li>
            </ul>
          </div>
        </section>

        <!-- API Service Global -->
        <section id="auth-service" class="bg-white rounded-xl shadow-md p-8">
          <div class="flex items-center space-x-3 mb-6">
            <span class="material-icons text-4xl gradient-text">code</span>
            <h2 class="text-3xl font-bold text-gray-800">Service API Global</h2>
          </div>
          <p class="text-gray-600 mb-4">
            Créer un fichier <code class="bg-gray-100 px-2 py-1 rounded">js/api-service.js</code>
            pour centraliser toutes les fonctions d'appel API.
          </p>

          <div class="code-block">
            <span class="code-label">js/api-service.js</span>
            <pre><code>// Configuration globale des APIs
const API_CONFIG = {
  backend: 'https://api.plateforme-academique.com/api/v1',
  ia: 'https://ia.plateforme-academique.com/api/v1',
  websocket: 'wss://realtime.plateforme-academique.com'
};

// Classe pour gérer les appels API
class ApiService {
  constructor() {
    this.token = localStorage.getItem('auth_token');
  }

  // Méthode générique pour les appels API
  async request(url, options = {}) {
    const headers = {
      'Content-Type': 'application/json',
      ...options.headers
    };

    // Ajouter le token si disponible
    if (this.token) {
      headers['Authorization'] = `Bearer ${this.token}`;
    }

    try {
      const response = await fetch(url, {
        ...options,
        headers
      });

      // Vérifier si la réponse est OK
      if (!response.ok) {
        if (response.status === 401) {
          // Token expiré ou invalide
          this.logout();
          window.location.href = '/login%20page/code.html';
          throw new Error('Session expirée');
        }
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      return await response.json();
    } catch (error) {
      console.error('Erreur API:', error);
      throw error;
    }
  }

  // Méthodes GET
  async get(endpoint) {
    return this.request(`${API_CONFIG.backend}${endpoint}`, {
      method: 'GET'
    });
  }

  // Méthodes POST
  async post(endpoint, data) {
    return this.request(`${API_CONFIG.backend}${endpoint}`, {
      method: 'POST',
      body: JSON.stringify(data)
    });
  }

  // Méthodes PUT
  async put(endpoint, data) {
    return this.request(`${API_CONFIG.backend}${endpoint}`, {
      method: 'PUT',
      body: JSON.stringify(data)
    });
  }

  // Méthodes DELETE
  async delete(endpoint) {
    return this.request(`${API_CONFIG.backend}${endpoint}`, {
      method: 'DELETE'
    });
  }

  // Méthodes PATCH
  async patch(endpoint, data = {}) {
    return this.request(`${API_CONFIG.backend}${endpoint}`, {
      method: 'PATCH',
      body: JSON.stringify(data)
    });
  }

  // Appel API IA
  async callIA(endpoint, data) {
    const headers = {
      'Content-Type': 'application/json',
      'X-API-Key': 'votre_api_key_ia' // À configurer
    };

    const response = await fetch(`${API_CONFIG.ia}${endpoint}`, {
      method: 'POST',
      headers,
      body: JSON.stringify(data)
    });

    if (!response.ok) {
      throw new Error(`Erreur IA! status: ${response.status}`);
    }

    return await response.json();
  }

  // Sauvegarder le token
  setToken(token) {
    this.token = token;
    localStorage.setItem('auth_token', token);
  }

  // Supprimer le token (déconnexion)
  logout() {
    this.token = null;
    localStorage.removeItem('auth_token');
    localStorage.removeItem('user_data');
  }

  // Récupérer les données utilisateur stockées
  getUserData() {
    const data = localStorage.getItem('user_data');
    return data ? JSON.parse(data) : null;
  }

  // Sauvegarder les données utilisateur
  setUserData(userData) {
    localStorage.setItem('user_data', JSON.stringify(userData));
  }
}

// Instance globale
const api = new ApiService();</code></pre>
          </div>

          <div class="highlight-box mt-4">
            <p class="text-amber-900 font-semibold mb-2">
              <span class="material-icons text-sm align-middle mr-1">warning</span>
              Important !
            </p>
            <p class="text-amber-800 text-sm">
              Inclure ce fichier dans <strong>toutes les pages</strong> avant vos scripts
              spécifiques :
              <code class="bg-white px-2 py-1 rounded">&lt;script src="../js/api-service.js"&gt;&lt;/script&gt;</code>
            </p>
          </div>
        </section>

        <!-- Login Page -->
        <section id="login" class="bg-white rounded-xl shadow-md p-8">
          <div class="flex items-center space-x-3 mb-6">
            <span class="material-icons text-4xl gradient-text">login</span>
            <h2 class="text-3xl font-bold text-gray-800">Login Page</h2>
          </div>
          <p class="text-gray-600 mb-4">
            <code class="bg-gray-100 px-2 py-1 rounded">login page/code.html</code>
          </p>

          <h3 class="text-xl font-bold text-gray-800 mb-3">APIs à consommer</h3>

          <div class="api-endpoint">
            <div class="flex items-center mb-2">
              <span class="api-method method-post">POST</span>
              <code class="text-white">/auth/login</code>
            </div>
            <p class="text-gray-400 text-sm">Authentifier l'utilisateur et récupérer le token</p>
          </div>

          <h3 class="text-xl font-bold text-gray-800 mb-3 mt-6">Implémentation</h3>

          <div class="code-block">
            <span class="code-label">JavaScript</span>
            <pre><code>// Dans login page/code.html
document.addEventListener('DOMContentLoaded', function() {
  const loginForm = document.getElementById('loginForm');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const errorDiv = document.getElementById('error-message');
  const loadingBtn = document.getElementById('loading-btn');

  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Masquer les erreurs précédentes
    errorDiv.classList.add('hidden');
    
    // Afficher le loading
    loadingBtn.classList.remove('hidden');
    
    try {
      // Appel API de connexion
      const response = await api.post('/auth/login', {
        email: emailInput.value,
        password: passwordInput.value
      });

      if (response.success) {
        // Sauvegarder le token
        api.setToken(response.data.token);
        
        // Sauvegarder les données utilisateur
        api.setUserData(response.data.user);
        
        // Redirection vers le dashboard
        window.location.href = '../student_dashboard_home_variant_1/code.html';
      }
    } catch (error) {
      // Afficher l'erreur
      errorDiv.textContent = 'Email ou mot de passe incorrect';
      errorDiv.classList.remove('hidden');
      loadingBtn.classList.add('hidden');
    }
  });
});</code></pre>
          </div>

          <div class="info-box mt-4">
            <p class="text-blue-900 font-semibold mb-2">Body de la requête</p>
            <pre class="text-sm"><code>{
  "email": "sophie@etudiant.fr",
  "password": "SecurePass123!"
}</code></pre>
          </div>

          <div class="info-box">
            <p class="text-blue-900 font-semibold mb-2">Réponse attendue</p>
            <pre class="text-sm"><code>{
  "success": true,
  "data": {
    "user": {
      "id": 123,
      "email": "sophie@etudiant.fr",
      "nom": "Martin",
      "prenom": "Sophie",
      "universite": "IFRI",
      "filiere": "Informatique",
      "niveau": "L2",
      "avatar_url": "https://...",
      "xp_total": 850,
      "niveau_gamification": 5
    },
    "token": "12|randomtoken..."
  }
}</code></pre>
          </div>
        </section>

        <!-- Dashboard -->
        <section id="dashboard" class="bg-white rounded-xl shadow-md p-8">
          <div class="flex items-center space-x-3 mb-6">
            <span class="material-icons text-4xl gradient-text">dashboard</span>
            <h2 class="text-3xl font-bold text-gray-800">Dashboard Étudiant</h2>
          </div>
          <p class="text-gray-600 mb-4">
            <code class="bg-gray-100 px-2 py-1 rounded">student_dashboard_home_variant_1/code.html</code>
          </p>

          <h3 class="text-xl font-bold text-gray-800 mb-3">APIs à consommer</h3>

          <div class="space-y-3">
            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/auth/me</code>
              </div>
              <p class="text-gray-400 text-sm">Récupérer les infos de l'utilisateur connecté</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/taches?statut=a_faire&limit=5</code>
              </div>
              <p class="text-gray-400 text-sm">Récupérer les 5 prochaines tâches</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/moyennes</code>
              </div>
              <p class="text-gray-400 text-sm">Récupérer la moyenne générale et par matière</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/alertes?is_read=false</code>
              </div>
              <p class="text-gray-400 text-sm">Récupérer les alertes non lues</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/emploi-temps</code>
              </div>
              <p class="text-gray-400 text-sm">Récupérer l'emploi du temps de la semaine</p>
            </div>
          </div>

          <h3 class="text-xl font-bold text-gray-800 mb-3 mt-6">Implémentation</h3>

          <div class="code-block">
            <span class="code-label">JavaScript</span>
            <pre><code>// Dans student_dashboard_home_variant_1/code.html
document.addEventListener('DOMContentLoaded', async function() {
  // Vérifier si l'utilisateur est connecté
  if (!api.token) {
    window.location.href = '../login%20page/code.html';
    return;
  }

  try {
    // Charger toutes les données en parallèle
    const [userData, taches, moyennes, alertes, emploiDuTemps] = await Promise.all([
      api.get('/auth/me'),
      api.get('/taches?statut=a_faire&limit=5'),
      api.get('/moyennes'),
      api.get('/alertes?is_read=false'),
      api.get('/emploi-temps')
    ]);

    // Afficher les informations utilisateur
    displayUserInfo(userData.data);
    
    // Afficher les tâches à venir
    displayTasks(taches.data);
    
    // Afficher les moyennes
    displayGrades(moyennes);
    
    // Afficher les alertes
    displayAlerts(alertes.data);
    
    // Afficher l'emploi du temps
    displaySchedule(emploiDuTemps.data);

  } catch (error) {
    console.error('Erreur chargement dashboard:', error);
    showError('Impossible de charger les données');
  }
});

// Fonction pour afficher les infos utilisateur
function displayUserInfo(user) {
  document.getElementById('user-name').textContent = `${user.prenom} ${user.nom}`;
  document.getElementById('user-level').textContent = user.niveau;
  document.getElementById('user-avatar').src = user.avatar_url || '/img/default-avatar.png';
  document.getElementById('user-xp').textContent = user.xp_total;
  document.getElementById('user-gamification-level').textContent = user.niveau_gamification;
}

// Fonction pour afficher les tâches
function displayTasks(taches) {
  const tasksList = document.getElementById('tasks-list');
  tasksList.innerHTML = '';

  taches.forEach(tache => {
    const taskItem = document.createElement('div');
    taskItem.className = 'task-item p-4 bg-gray-50 rounded-lg mb-2';
    
    // Calculer les jours restants
    const deadline = new Date(tache.date_limite);
    const today = new Date();
    const daysLeft = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
    
    taskItem.innerHTML = `
      <div class="flex justify-between items-start">
        <div>
          <h4 class="font-semibold text-gray-800">${tache.titre}</h4>
          <p class="text-sm text-gray-600">${tache.matiere?.nom || 'Non assignée'}</p>
        </div>
        <span class="px-2 py-1 rounded text-xs ${getPriorityClass(tache.priorite)}">
          ${tache.priorite}
        </span>
      </div>
      <div class="mt-2 text-sm text-gray-500">
        <span class="material-icons text-xs align-middle">schedule</span>
        ${daysLeft} jour(s) restant(s)
      </div>
    `;
    
    tasksList.appendChild(taskItem);
  });
}

// Fonction pour afficher les moyennes
function displayGrades(moyennes) {
  document.getElementById('moyenne-generale').textContent = 
    moyennes.moyenne_generale.toFixed(2);

  const gradesList = document.getElementById('grades-list');
  gradesList.innerHTML = '';

  moyennes.matieres.forEach(matiere => {
    const gradeItem = document.createElement('div');
    gradeItem.className = 'flex justify-between items-center p-3 bg-gray-50 rounded mb-2';
    gradeItem.innerHTML = `
      <span class="font-medium">${matiere.nom}</span>
      <span class="font-bold ${getGradeColor(matiere.moyenne)}">
        ${matiere.moyenne.toFixed(2)}
      </span>
    `;
    gradesList.appendChild(gradeItem);
  });
}

// Fonction pour afficher les alertes
function displayAlerts(alertes) {
  const alertsList = document.getElementById('alerts-list');
  alertsList.innerHTML = '';

  if (alertes.length === 0) {
    alertsList.innerHTML = '<p class="text-gray-500 text-sm">Aucune alerte</p>';
    return;
  }

  alertes.forEach(alerte => {
    const alertItem = document.createElement('div');
    alertItem.className = `alert-item p-4 rounded-lg mb-2 border-l-4 ${getSeverityClass(alerte.niveau_severite)}`;
    alertItem.innerHTML = `
      <h4 class="font-semibold">${alerte.type_alerte}</h4>
      <p class="text-sm mt-1">${alerte.message}</p>
      <button onclick="markAlertAsRead(${alerte.id})" class="text-xs text-blue-600 mt-2">
        Marquer comme lu
      </button>
    `;
    alertsList.appendChild(alertItem);
  });
}

// Marquer une alerte comme lue
async function markAlertAsRead(alertId) {
  try {
    await api.patch(`/alertes/${alertId}/read`);
    // Recharger les alertes
    const alertes = await api.get('/alertes?is_read=false');
    displayAlerts(alertes.data);
  } catch (error) {
    console.error('Erreur marquage alerte:', error);
  }
}

// Classes CSS helper
function getPriorityClass(priority) {
  const classes = {
    'haute': 'bg-red-100 text-red-800',
    'moyenne': 'bg-yellow-100 text-yellow-800',
    'basse': 'bg-green-100 text-green-800'
  };
  return classes[priority] || 'bg-gray-100 text-gray-800';
}

function getGradeColor(grade) {
  if (grade >= 14) return 'text-green-600';
  if (grade >= 10) return 'text-yellow-600';
  return 'text-red-600';
}

function getSeverityClass(severity) {
  const classes = {
    'rouge': 'border-red-500 bg-red-50',
    'orange': 'border-orange-500 bg-orange-50',
    'jaune': 'border-yellow-500 bg-yellow-50'
  };
  return classes[severity] || 'border-gray-500 bg-gray-50';
}</code></pre>
          </div>
        </section>

        <!-- Profile -->
        <section id="profile" class="bg-white rounded-xl shadow-md p-8">
          <div class="flex items-center space-x-3 mb-6">
            <span class="material-icons text-4xl gradient-text">account_circle</span>
            <h2 class="text-3xl font-bold text-gray-800">Profil Étudiant</h2>
          </div>
          <p class="text-gray-600 mb-4">
            <code class="bg-gray-100 px-2 py-1 rounded">student_profile_page_variant_2/code.html</code>
          </p>

          <h3 class="text-xl font-bold text-gray-800 mb-3">APIs à consommer</h3>

          <div class="space-y-3">
            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/auth/me</code>
              </div>
              <p class="text-gray-400 text-sm">Récupérer le profil complet</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/matieres</code>
              </div>
              <p class="text-gray-400 text-sm">Liste des matières de l'étudiant</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-put">PUT</span>
                <code class="text-white">/auth/profile</code>
              </div>
              <p class="text-gray-400 text-sm">Mettre à jour le profil</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/badges/mes-badges</code>
              </div>
              <p class="text-gray-400 text-sm">Badges obtenus par l'étudiant</p>
            </div>
          </div>

          <h3 class="text-xl font-bold text-gray-800 mb-3 mt-6">Implémentation</h3>

          <div class="code-block">
            <span class="code-label">JavaScript</span>
            <pre><code>// Charger le profil
async function loadProfile() {
  try {
    const [profile, matieres, badges] = await Promise.all([
      api.get('/auth/me'),
      api.get('/matieres'),
      api.get('/badges/mes-badges')
    ]);

    displayProfile(profile.data);
    displayMatieres(matieres.data);
    displayBadges(badges.data);
  } catch (error) {
    console.error('Erreur chargement profil:', error);
  }
}

// Formulaire de modification du profil
const profileForm = document.getElementById('profile-form');
profileForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const formData = {
    nom: document.getElementById('nom').value,
    prenom: document.getElementById('prenom').value,
    universite: document.getElementById('universite').value,
    filiere: document.getElementById('filiere').value,
    niveau: document.getElementById('niveau').value,
    objectif_moyenne: parseFloat(document.getElementById('objectif_moyenne').value),
    style_apprentissage: document.getElementById('style_apprentissage').value
  };

  try {
    const response = await api.put('/auth/profile', formData);
    
    if (response.success) {
      // Mettre à jour les données locales
      api.setUserData(response.data);
      
      // Afficher message de succès
      showSuccess('Profil mis à jour avec succès !');
    }
  } catch (error) {
    showError('Erreur lors de la mise à jour du profil');
  }
});</code></pre>
          </div>
        </section>

        <!-- Calendar -->
        <section id="calendar" class="bg-white rounded-xl shadow-md p-8">
          <div class="flex items-center space-x-3 mb-6">
            <span class="material-icons text-4xl gradient-text">calendar_month</span>
            <h2 class="text-3xl font-bold text-gray-800">Calendrier Hebdomadaire</h2>
          </div>
          <p class="text-gray-600 mb-4">
            <code class="bg-gray-100 px-2 py-1 rounded">calendar_weekly_view_variant_1/code.html</code>
          </p>

          <h3 class="text-xl font-bold text-gray-800 mb-3">APIs à consommer</h3>

          <div class="space-y-3">
            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/emploi-temps</code>
              </div>
              <p class="text-gray-400 text-sm">Emploi du temps complet</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/taches?date_limite_min=2026-02-15&date_limite_max=2026-02-21</code>
              </div>
              <p class="text-gray-400 text-sm">Tâches de la semaine</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-post">POST</span>
                <code class="text-white">/emploi-temps/cours</code>
              </div>
              <p class="text-gray-400 text-sm">Ajouter un cours</p>
            </div>
          </div>

          <h3 class="text-xl font-bold text-gray-800 mb-3 mt-6">Implémentation</h3>

          <div class="code-block">
            <span class="code-label">JavaScript</span>
            <pre><code>// Charger le calendrier de la semaine
async function loadCalendar() {
  try {
    const emploiTemps = await api.get('/emploi-temps');
    
    // Organiser par jour de la semaine
    const schedule = organizeByDay(emploiTemps.data);
    
    // Afficher dans le calendrier
    displayCalendar(schedule);
  } catch (error) {
    console.error('Erreur chargement calendrier:', error);
  }
}

function organizeByDay(courses) {
  const days = {
    'lundi': [],
    'mardi': [],
    'mercredi': [],
    'jeudi': [],
    'vendredi': [],
    'samedi': []
  };

  courses.forEach(course => {
    if (days[course.jour_semaine]) {
      days[course.jour_semaine].push(course);
    }
  });

  // Trier par heure de début
  Object.keys(days).forEach(day => {
    days[day].sort((a, b) => a.heure_debut.localeCompare(b.heure_debut));
  });

  return days;
}

function displayCalendar(schedule) {
  Object.keys(schedule).forEach(day => {
    const dayColumn = document.getElementById(`day-${day}`);
    dayColumn.innerHTML = '';

    schedule[day].forEach(course => {
      const courseBlock = document.createElement('div');
      courseBlock.className = 'course-block p-3 rounded mb-2';
      courseBlock.style.backgroundColor = course.matiere.couleur || '#3B82F6';
      courseBlock.style.color = 'white';
      
      courseBlock.innerHTML = `
        <div class="font-semibold text-sm">${course.matiere.nom}</div>
        <div class="text-xs opacity-90">${course.heure_debut} - ${course.heure_fin}</div>
        <div class="text-xs opacity-90">${course.salle}</div>
        <div class="text-xs opacity-75">${course.type_cours}</div>
      `;
      
      dayColumn.appendChild(courseBlock);
    });
  });
}</code></pre>
          </div>
        </section>

        <!-- Grades -->
        <section id="grades" class="bg-white rounded-xl shadow-md p-8">
          <div class="flex items-center space-x-3 mb-6">
            <span class="material-icons text-4xl gradient-text">grade</span>
            <h2 class="text-3xl font-bold text-gray-800">Gestion des Notes</h2>
          </div>
          <p class="text-gray-600 mb-4">
            <code class="bg-gray-100 px-2 py-1 rounded">grade_management_interface_variant_1/code.html</code>
          </p>

          <h3 class="text-xl font-bold text-gray-800 mb-3">APIs à consommer</h3>

          <div class="space-y-3">
            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/notes</code>
              </div>
              <p class="text-gray-400 text-sm">Liste de toutes les notes</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/moyennes</code>
              </div>
              <p class="text-gray-400 text-sm">Moyennes par matière + générale</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-post">POST</span>
                <code class="text-white">/notes</code>
              </div>
              <p class="text-gray-400 text-sm">Ajouter une nouvelle note</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/notes?matiere_id=5</code>
              </div>
              <p class="text-gray-400 text-sm">Filtrer notes par matière</p>
            </div>
          </div>

          <h3 class="text-xl font-bold text-gray-800 mb-3 mt-6">Implémentation</h3>

          <div class="code-block">
            <span class="code-label">JavaScript</span>
            <pre><code>// Charger les notes
async function loadGrades() {
  try {
    const [notes, moyennes, matieres] = await Promise.all([
      api.get('/notes'),
      api.get('/moyennes'),
      api.get('/matieres')
    ]);

    displayGradesTable(notes.data, matieres.data);
    displayAverages(moyennes);
  } catch (error) {
    console.error('Erreur chargement notes:', error);
  }
}

// Afficher les notes dans un tableau
function displayGradesTable(notes, matieres) {
  const tbody = document.getElementById('grades-tbody');
  tbody.innerHTML = '';

  notes.forEach(note => {
    const matiere = matieres.find(m => m.id === note.matiere_id);
    const row = document.createElement('tr');
    row.className = 'hover:bg-gray-50';
    
    row.innerHTML = `
      <td class="px-4 py-3">${matiere?.nom || 'N/A'}</td>
      <td class="px-4 py-3">${note.type_evaluation}</td>
      <td class="px-4 py-3">${note.intitule}</td>
      <td class="px-4 py-3 font-bold ${getGradeColor(note.note_obtenue)}">
        ${note.note_obtenue}/${note.note_maximale}
      </td>
      <td class="px-4 py-3">${note.coefficient}</td>
      <td class="px-4 py-3">${formatDate(note.date_evaluation)}</td>
    `;
    
    tbody.appendChild(row);
  });
}

// Formulaire d'ajout de note
const addGradeForm = document.getElementById('add-grade-form');
addGradeForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const gradeData = {
    matiere_id: parseInt(document.getElementById('matiere').value),
    type_evaluation: document.getElementById('type_evaluation').value,
    intitule: document.getElementById('intitule').value,
    note_obtenue: parseFloat(document.getElementById('note_obtenue').value),
    note_maximale: parseFloat(document.getElementById('note_maximale').value),
    coefficient: parseFloat(document.getElementById('coefficient').value),
    date_evaluation: document.getElementById('date_evaluation').value
  };

  try {
    const response = await api.post('/notes', gradeData);
    
    if (response.success) {
      showSuccess('Note ajoutée avec succès !');
      // Recharger les notes
      loadGrades();
      // Réinitialiser le formulaire
      addGradeForm.reset();
    }
  } catch (error) {
    showError('Erreur lors de l\'ajout de la note');
  }
});

// Filtrer par matière
const matiereFilter = document.getElementById('matiere-filter');
matiereFilter.addEventListener('change', async (e) => {
  const matiereId = e.target.value;
  
  try {
    const url = matiereId ? `/notes?matiere_id=${matiereId}` : '/notes';
    const notes = await api.get(url);
    const matieres = await api.get('/matieres');
    displayGradesTable(notes.data, matieres.data);
  } catch (error) {
    console.error('Erreur filtrage:', error);
  }
});</code></pre>
          </div>
        </section>

        <!-- Quiz -->
        <section id="quiz" class="bg-white rounded-xl shadow-md p-8">
          <div class="flex items-center space-x-3 mb-6">
            <span class="material-icons text-4xl gradient-text">quiz</span>
            <h2 class="text-3xl font-bold text-gray-800">Quiz Interactif</h2>
          </div>
          <p class="text-gray-600 mb-4">
            <code class="bg-gray-100 px-2 py-1 rounded">interactive_quiz_interface_variant_2/code.html</code>
          </p>

          <div class="highlight-box">
            <p class="text-amber-900 font-semibold mb-2">
              <span class="material-icons text-sm align-middle mr-1">cable</span>
              Socket.io requis !
            </p>
            <p class="text-amber-800 text-sm">
              Cette page nécessite Socket.io pour le temps réel. Inclure :
              <code
                class="bg-white px-2 py-1 rounded">&lt;script src="https://cdn.socket.io/4.5.4/socket.io.min.js"&gt;&lt;/script&gt;</code>
            </p>
          </div>

          <h3 class="text-xl font-bold text-gray-800 mb-3 mt-6">APIs à consommer</h3>

          <div class="space-y-3">
            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/contenus-ia?type_contenu=quiz</code>
              </div>
              <p class="text-gray-400 text-sm">Liste des quiz disponibles (REST)</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/quiz-questions?contenu_ia_id=42</code>
              </div>
              <p class="text-gray-400 text-sm">Questions d'un quiz (REST)</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-post">POST</span>
                <code class="text-white">/quiz-resultats</code>
              </div>
              <p class="text-gray-400 text-sm">Enregistrer le résultat final (REST)</p>
            </div>
          </div>

          <h3 class="text-xl font-bold text-gray-800 mb-3 mt-4">WebSocket (temps réel)</h3>

          <div class="code-block">
            <span class="code-label">JavaScript</span>
            <pre><code>// Connexion WebSocket
const socket = io('wss://realtime.plateforme-academique.com', {
  auth: {
    token: api.token
  }
});

// Rejoindre un quiz
function joinQuiz(quizId) {
  socket.emit('join-quiz', {
    quiz_id: quizId,
    user_id: api.getUserData().id,
    token: api.token
  });
}

// Écouter les mises à jour du quiz
socket.on('quiz-update', (data) => {
  // data = { question_index: 3, question: {...}, time_limit: 20 }
  displayQuestion(data.question, data.question_index, data.time_limit);
  startTimer(data.time_limit);
});

// Écouter le classement en temps réel
socket.on('leaderboard-update', (data) => {
  // data = [{ user: 'Sophie', score: 850 }, ...]
  updateLeaderboard(data);
});

// Envoyer une réponse
function submitAnswer(questionId, answer) {
  const startTime = window.questionStartTime;
  const endTime = Date.now();
  const responseTime = (endTime - startTime) / 1000; // secondes

  socket.emit('answer-question', {
    quiz_id: currentQuizId,
    question_id: questionId,
    reponse: answer,
    temps_reponse: responseTime
  });
}

// Quiz terminé
socket.on('quiz-ended', async (data) => {
  // data = { final_scores: [...], winner: {...} }
  displayResults(data);
  
  // Enregistrer le résultat dans la BDD via REST
  try {
    await api.post('/quiz-resultats', {
      contenu_ia_id: currentQuizId,
      score: data.final_scores.find(s => s.user_id === api.getUserData().id).score,
      total_questions: totalQuestions,
      temps_passe: totalTime,
      reponses_json: userAnswers
    });
  } catch (error) {
    console.error('Erreur sauvegarde résultat:', error);
  }
});

// Afficher une question
function displayQuestion(question, index, timeLimit) {
  window.questionStartTime = Date.now();
  
  const questionContainer = document.getElementById('question-container');
  questionContainer.innerHTML = `
    <div class="question-header">
      <h3>Question ${index + 1}/${totalQuestions}</h3>
      <div id="timer" class="timer">${timeLimit}s</div>
    </div>
    <p class="question-text">${question.question}</p>
    <div class="options">
      ${question.options.map((option, i) => `
        <button class="option-btn" onclick="selectAnswer('${String.fromCharCode(65 + i)}')">
          ${String.fromCharCode(65 + i)}. ${option}
        </button>
      `).join('')}
    </div>
  `;
}

// Timer
function startTimer(seconds) {
  let remaining = seconds;
  const timerEl = document.getElementById('timer');
  
  const interval = setInterval(() => {
    remaining--;
    timerEl.textContent = `${remaining}s`;
    
    if (remaining <= 0) {
      clearInterval(interval);
      // Temps écoulé - soumettre réponse vide
      submitAnswer(currentQuestionId, null);
    }
  }, 1000);
}

// Sélectionner une réponse
function selectAnswer(answer) {
  submitAnswer(currentQuestionId, answer);
  // Désactiver les boutons
  document.querySelectorAll('.option-btn').forEach(btn => {
    btn.disabled = true;
  });
}</code></pre>
          </div>
        </section>

        <!-- AI Generation -->
        <section id="ai-generation" class="bg-white rounded-xl shadow-md p-8">
          <div class="flex items-center space-x-3 mb-6">
            <span class="material-icons text-4xl gradient-text">auto_awesome</span>
            <h2 class="text-3xl font-bold text-gray-800">Génération IA</h2>
          </div>
          <p class="text-gray-600 mb-4">
            <code class="bg-gray-100 px-2 py-1 rounded">ai_content_generation_variant_1/code.html</code>
          </p>

          <h3 class="text-xl font-bold text-gray-800 mb-3">APIs à consommer</h3>

          <div class="space-y-3">
            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-post">POST</span>
                <code class="text-white">/ai/generate-summary</code> (Service IA)
              </div>
              <p class="text-gray-400 text-sm">Générer une fiche de révision</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-post">POST</span>
                <code class="text-white">/ai/generate-quiz</code> (Service IA)
              </div>
              <p class="text-gray-400 text-sm">Générer un QCM</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-post">POST</span>
                <code class="text-white">/ai/generate-podcast</code> (Service IA)
              </div>
              <p class="text-gray-400 text-sm">Générer un podcast audio</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-post">POST</span>
                <code class="text-white">/ai/extract-from-pdf</code> (Service IA)
              </div>
              <p class="text-gray-400 text-sm">Extraire texte depuis PDF</p>
            </div>
          </div>

          <h3 class="text-xl font-bold text-gray-800 mb-3 mt-6">Implémentation</h3>

          <div class="code-block">
            <span class="code-label">JavaScript</span>
            <pre><code>// Formulaire de génération
const generateForm = document.getElementById('generate-form');
generateForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const contentType = document.getElementById('content-type').value;
  const sourceText = document.getElementById('source-text').value;
  const matiereId = document.getElementById('matiere').value;

  // Afficher loading
  showLoading('Génération en cours... Cela peut prendre quelques secondes');

  try {
    let result;
    
    switch(contentType) {
      case 'fiche':
        result = await api.callIA('/ai/generate-summary', {
          contenu_source: sourceText,
          matiere: getMatiereNameById(matiereId),
          niveau_detail: 'moyen',
          format_sortie: 'pdf'
        });
        break;

      case 'quiz':
        result = await api.callIA('/ai/generate-quiz', {
          contenu_source: sourceText,
          matiere: getMatiereNameById(matiereId),
          nb_questions: 15,
          difficulte: 'moyen'
        });
        break;

      case 'podcast':
        result = await api.callIA('/ai/generate-podcast', {
          texte_source: sourceText,
          voix: 'fr-FR-DeniseNeural',
          vitesse: 1.0,
          titre: `Cours ${getMatiereNameById(matiereId)}`
        });
        break;

      case 'exercices':
        result = await api.callIA('/ai/generate-exercises', {
          contenu_source: sourceText,
          matiere: getMatiereNameById(matiereId),
          nb_exercices: 5,
          difficulte: 'moyen'
        });
        break;
    }

    if (result.success) {
      // Enregistrer le contenu généré dans la BDD Laravel
      const savedContent = await api.post('/contenus-ia', {
        matiere_id: matiereId,
        type_contenu: contentType,
        titre: `${contentType} - ${getMatiereNameById(matiereId)}`,
        contenu_json: result,
        fichier_url: result.fichier_pdf_url || result.fichier_mp3_url || null,
        temps_generation: result.temps_generation || null
      });

      hideLoading();
      showSuccess('Contenu généré avec succès !');
      
      // Rediriger vers la page des résultats
      window.location.href = `../ai_generation_results_variant_2/code.html?id=${savedContent.data.id}`;
    }
  } catch (error) {
    hideLoading();
    showError('Erreur lors de la génération : ' + error.message);
  }
});

// Upload de fichier PDF
const fileUpload = document.getElementById('file-upload');
fileUpload.addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  // Upload du fichier (utiliser FormData)
  const formData = new FormData();
  formData.append('file', file);

  showLoading('Upload et extraction en cours...');

  try {
    // D'abord upload vers votre serveur Laravel
    const uploadResponse = await fetch(`${API_CONFIG.backend}/upload`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${api.token}`
      },
      body: formData
    });

    const uploadData = await uploadResponse.json();
    const fileUrl = uploadData.file_url;

    // Ensuite extraction via service IA
    const extractResult = await api.callIA('/ai/extract-from-pdf', {
      pdf_url: fileUrl,
      extract_tasks: true,
      extract_dates: true,
      extract_structure: true
    });

    hideLoading();

    // Afficher le texte extrait dans le textarea
    document.getElementById('source-text').value = extractResult.extraction.texte_complet;
    
    // Afficher les devoirs détectés
    if (extractResult.extraction.devoirs_detectes?.length > 0) {
      displayDetectedTasks(extractResult.extraction.devoirs_detectes);
    }

  } catch (error) {
    hideLoading();
    showError('Erreur lors de l\'extraction du PDF');
  }
});</code></pre>
          </div>
        </section>

        <!-- AI Results -->
        <section id="ai-results" class="bg-white rounded-xl shadow-md p-8">
          <div class="flex items-center space-x-3 mb-6">
            <span class="material-icons text-4xl gradient-text">description</span>
            <h2 class="text-3xl font-bold text-gray-800">Résultats IA</h2>
          </div>
          <p class="text-gray-600 mb-4">
            <code class="bg-gray-100 px-2 py-1 rounded">ai_generation_results_variant_2/code.html</code>
          </p>

          <h3 class="text-xl font-bold text-gray-800 mb-3">APIs à consommer</h3>

          <div class="space-y-3">
            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/contenus-ia/{id}</code>
              </div>
              <p class="text-gray-400 text-sm">Récupérer le contenu généré</p>
            </div>

            <div class="api-endpoint">
              <div class="flex items-center mb-2">
                <span class="api-method method-get">GET</span>
                <code class="text-white">/quiz-questions?contenu_ia_id={id}</code>
              </div>
              <p class="text-gray-400 text-sm">Questions si c'est un quiz</p>
            </div>
          </div>

          <h3 class="text-xl font-bold text-gray-800 mb-3 mt-6">Implémentation</h3>

          <div class="code-block">
            <span class="code-label">JavaScript</span>
            <pre><code>// Récupérer l'ID du contenu depuis l'URL
const urlParams = new URLSearchParams(window.location.search);
const contentId = urlParams.get('id');

// Charger le contenu
async function loadContent() {
  if (!contentId) {
    showError('ID de contenu manquant');
    return;
  }

  try {
    const content = await api.get(`/contenus-ia/${contentId}`);
    
    displayContentHeader(content.data);
    
    switch(content.data.type_contenu) {
      case 'fiche_resume':
        displaySummary(content.data);
        break;
      
      case 'quiz':
        await displayQuiz(content.data);
        break;
      
      case 'podcast':
        displayPodcast(content.data);
        break;
      
      case 'exercice':
        displayExercises(content.data);
        break;
    }
  } catch (error) {
    showError('Impossible de charger le contenu');
  }
}

// Afficher une fiche de révision
function displaySummary(content) {
  const container = document.getElementById('content-container');
  
  container.innerHTML = `
    <div class="summary-content">
      ${content.contenu_json.contenu_html}
    </div>
    <div class="actions mt-6">
      <a href="${content.fichier_url}" 
         download 
         class="btn btn-primary">
        <span class="material-icons">download</span>
        Télécharger PDF
      </a>
      <button onclick="printContent()" class="btn btn-secondary">
        <span class="material-icons">print</span>
        Imprimer
      </button>
    </div>
  `;
}

// Afficher un quiz
async function displayQuiz(content) {
  // Récupérer les questions
  const questions = await api.get(`/quiz-questions?contenu_ia_id=${content.id}`);
  
  const container = document.getElementById('content-container');
  let html = '<div class="quiz-questions space-y-6">';
  
  questions.data.forEach((q, index) => {
    html += `
      <div class="question-card bg-gray-50 p-6 rounded-lg">
        <h4 class="font-bold text-lg mb-3">Question ${index + 1}</h4>
        <p class="mb-4">${q.question}</p>
        <div class="options space-y-2">
          ${q.options.map((opt, i) => `
            <div class="option flex items-center">
              <input type="radio" 
                     name="question_${q.id}" 
                     id="q${q.id}_opt${i}"
                     value="${String.fromCharCode(65 + i)}">
              <label for="q${q.id}_opt${i}" class="ml-2">
                ${String.fromCharCode(65 + i)}. ${opt}
              </label>
            </div>
          `).join('')}
        </div>
        <button onclick="revealAnswer(${q.id}, '${q.reponse_correcte}')" 
                class="mt-4 text-blue-600 text-sm">
          Voir la réponse
        </button>
        <div id="explanation_${q.id}" class="hidden mt-3 p-3 bg-blue-50 rounded">
          <strong>Réponse correcte :</strong> ${q.reponse_correcte}<br>
          <strong>Explication :</strong> ${q.explication}
        </div>
      </div>
    `;
  });
  
  html += '</div>';
  container.innerHTML = html;
}

// Afficher un podcast
function displayPodcast(content) {
  const container = document.getElementById('content-container');
  
  container.innerHTML = `
    <div class="podcast-player bg-gradient-to-r from-purple-500 to-purple-600 p-8 rounded-lg text-white">
      <h3 class="text-2xl font-bold mb-4">${content.titre}</h3>
      <audio controls class="w-full mt-4">
        <source src="${content.fichier_url}" type="audio/mpeg">
        Votre navigateur ne supporte pas l'audio HTML5.
      </audio>
      <div class="mt-4 text-sm opacity-90">
        Durée : ${Math.floor(content.contenu_json.duree_secondes / 60)} minutes
      </div>
      <div class="actions mt-6">
        <a href="${content.fichier_url}" 
           download 
           class="bg-white text-purple-600 px-4 py-2 rounded inline-block">
          <span class="material-icons align-middle">download</span>
          Télécharger MP3
        </a>
      </div>
    </div>
  `;
}

// Révéler la réponse d'une question
function revealAnswer(questionId, correctAnswer) {
  const explanationDiv = document.getElementById(`explanation_${questionId}`);
  explanationDiv.classList.toggle('hidden');
}</code></pre>
          </div>
        </section>

        <!-- Best Practices -->
        <section id="best-practices" class="bg-white rounded-xl shadow-md p-8">
          <div class="flex items-center space-x-3 mb-6">
            <span class="material-icons text-4xl gradient-text">tips_and_updates</span>
            <h2 class="text-3xl font-bold text-gray-800">Bonnes Pratiques</h2>
          </div>

          <div class="space-y-6">
            <div class="card-hover border-2 border-blue-200 rounded-lg p-6">
              <h3 class="font-bold text-blue-900 mb-3 flex items-center">
                <span class="material-icons mr-2">security</span>
                1. Gestion de l'Authentification
              </h3>
              <ul class="text-gray-700 text-sm space-y-2">
                <li>
                  ✓ Toujours vérifier la présence du token au chargement de chaque page protégée
                </li>
                <li>✓ Rediriger vers login si token absent ou expiré</li>
                <li>✓ Inclure le token dans le header <code>Authorization: Bearer {token}</code></li>
                <li>
                  ✓ Stocker le token dans localStorage (ou sessionStorage pour plus de sécurité)
                </li>
                <li>✓ Nettoyer le localStorage lors de la déconnexion</li>
              </ul>
            </div>

            <div class="card-hover border-2 border-green-200 rounded-lg p-6">
              <h3 class="font-bold text-green-900 mb-3 flex items-center">
                <span class="material-icons mr-2">sync</span>
                2. Chargement des Données
              </h3>
              <ul class="text-gray-700 text-sm space-y-2">
                <li>✓ Utiliser <code>Promise.all()</code> pour charger plusieurs APIs en parallèle</li>
                <li>✓ Afficher un indicateur de chargement (spinner, skeleton) pendant les requêtes</li>
                <li>✓ Gérer les erreurs avec try/catch et afficher des messages utilisateur</li>
                <li>✓ Implémenter un système de retry pour les requêtes échouées</li>
                <li>✓ Cacher les données fréquemment utilisées (localStorage, sessionStorage)</li>
              </ul>
            </div>

            <div class="card-hover border-2 border-purple-200 rounded-lg p-6">
              <h3 class="font-bold text-purple-900 mb-3 flex items-center">
                <span class="material-icons mr-2">error_outline</span>
                3. Gestion des Erreurs
              </h3>
              <div class="code-block">
                <pre><code>// Exemple de gestion d'erreur robuste
async function safeFetch(apiCall) {
  try {
    const response = await apiCall();
    return { success: true, data: response };
  } catch (error) {
    console.error('Erreur API:', error);
    
    // Gestion spécifique selon le type d'erreur
    if (error.message.includes('401')) {
      return { success: false, error: 'Session expirée', redirect: '/login' };
    } else if (error.message.includes('500')) {
      return { success: false, error: 'Erreur serveur, veuillez réessayer' };
    } else if (error.message.includes('Network')) {
      return { success: false, error: 'Problème de connexion internet' };
    }
    
    return { success: false, error: 'Une erreur est survenue' };
  }
}</code></pre>
              </div>
            </div>

            <div class="card-hover border-2 border-orange-200 rounded-lg p-6">
              <h3 class="font-bold text-orange-900 mb-3 flex items-center">
                <span class="material-icons mr-2">speed</span>
                4. Performance
              </h3>
              <ul class="text-gray-700 text-sm space-y-2">
                <li>✓ Debounce les recherches et filtres (attendre 300ms après la dernière frappe)</li>
                <li>✓ Pagination pour les longues listes (ne pas charger 1000 éléments d'un coup)</li>
                <li>✓ Lazy loading pour les images et contenus lourds</li>
                <li>✓ Minimiser les appels API (grouper les requêtes quand possible)</li>
                <li>✓ Utiliser des WebSockets uniquement quand le temps réel est nécessaire</li>
              </ul>
            </div>

            <div class="card-hover border-2 border-red-200 rounded-lg p-6">
              <h3 class="font-bold text-red-900 mb-3 flex items-center">
                <span class="material-icons mr-2">bug_report</span>
                5. Débogage
              </h3>
              <ul class="text-gray-700 text-sm space-y-2">
                <li>
                  ✓ Utiliser <code>console.log</code> pour tracer les appels API et réponses
                </li>
                <li>✓ Vérifier l'onglet Network dans DevTools pour voir les requêtes HTTP</li>
                <li>✓ Vérifier le localStorage pour s'assurer que le token est bien sauvegardé</li>
                <li>✓ Tester avec différents scénarios (token expiré, erreur serveur, etc.)</li>
                <li>✓ Utiliser des outils comme Postman pour tester les APIs indépendamment</li>
              </ul>
            </div>

            <div class="card-hover border-2 border-indigo-200 rounded-lg p-6">
              <h3 class="font-bold text-indigo-900 mb-3 flex items-center">
                <span class="material-icons mr-2">code</span>
                6. Organisation du Code
              </h3>
              <ul class="text-gray-700 text-sm space-y-2">
                <li>✓ Séparer la logique API dans <code>js/api-service.js</code></li>
                <li>✓ Créer des fonctions réutilisables pour afficher les données</li>
                <li>
                  ✓ Utiliser des constantes pour les URLs, clés API, configurations
                </li>
                <li>✓ Commenter le code pour expliquer les logiques complexes</li>
                <li>✓ Suivre une convention de nommage cohérente (camelCase pour JS)</li>
              </ul>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="gradient-bg text-white py-8 mt-12">
    <div class="max-w-7xl mx-auto px-6 text-center">
      <p class="text-lg font-semibold mb-2">Guide d'Intégration Frontend</p>
      <p class="text-sm opacity-90">Stack Vanilla HTML/CSS/JavaScript — Février 2026</p>
    </div>
  </footer>

  <!-- Smooth scroll script -->
  <script>
    // Active link highlighting on scroll
    const sections = document.querySelectorAll("section[id]");
    const navLinks = document.querySelectorAll(".nav-link");

    window.addEventListener("scroll", () => {
      let current = "";

      sections.forEach((section) => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.clientHeight;
        if (pageYOffset >= sectionTop - 200) {
          current = section.getAttribute("id");
        }
      });

      navLinks.forEach((link) => {
        link.classList.remove("active");
        if (link.getAttribute("href") === `#${current}`) {
          link.classList.add("active");
        }
      });
    });
  </script>
</body>

</html>